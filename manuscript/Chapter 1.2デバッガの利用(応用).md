# Chapter 1 C++による大規模開発
## 1.2 デバッガの利用(応用)
このチャプターでは、デバッガの利用をさらに見ていきましょう。
</br>
この節では二つのプログラムを使用します。次のURLからプログラムをダウンロードしておいてください。</br>


</br>

---
### 1.2.1 呼び出し履歴
関数の呼び出し履歴を確認することができます。</br>
呼び出し履歴は、メニューの「デバッグ/ウィンドウ/呼び出し履歴」を選択すると開くことができます(図1.13)。</br>
</br>

**図1.13**</br>
<img src="fig/1.13.png"></img></br>
呼び出し履歴を開くと画面の下の方に、呼び出し履歴のウィンドウが追加されます(図1.14)。</br>
</br>

**図1.13**</br>
<img src="fig/1.13.png"></img></br>

呼び出し履歴はブレイクポイントでプログラムを停止しているときに利用することができます。</br>
呼び出し履歴は、関数がどこから呼ばれているのかをコールされてきたのかを確認することができます。</br>
図1.15はDispComNoTe()のブレイクポイントでプログラムが停止しています。</br>
</br>

**図1.15**</br>
<img src="fig/1.15.png"></img></br>

このとき、呼び出し履歴を確認すると、DispComNoTe()はmain()から呼ばれていることが分かります。</br>
呼び出し元のプログラムをは、呼び出し元の関数名をダブルクリックすることで確認することができます。</br>
(注意：呼び出し元に戻ったときに、１行ずれているので注意が必要です。)</br>

---
### 1.2.2 【ハンズオン】呼び出し履歴を使ってみる。
Sample_01を利用して呼び出し履歴を使ってみましょう。

#### step-1 DispPlayerNoTe()にブレイクポイントを設置する。
DispPlayerNoTe()の10行目にブレイクポイントを設置してください。

#### step-2 ブレイクポイントでプログラムを停止させる。
では、じゃんけんゲームをデバッガありで実行して、プレイして先ほどのブレイクポイントでプログラムを停止させてください。</br>

#### step-3 呼び出し履歴を確認する
プログラムを停止させることができたら、呼び出し履歴をつかって、DispPlayerNoTe()が何行目から呼ばれているか確認してください。</br>

---
### 1.2.3 出力
プログラムからのコンソール出力を確認することができます。</br>
出力は、メニューの「デバッグ/ウィンドウ/出力」を選択することで開くことができます(図1.16)。</br>

</br>

**図1.16**</br>
<img src="fig/1.16.png"></img></br>
開くと画面の下の方に、出力ウィンドウが追加されます(図1.17)。</br></br>

**図1.17**</br>
<img src="fig/1.17.png"></img></br>
出力ウィンドウには、プログラムから重要なランタイムのエラーメッセージが出力されている場合があります。</br>
特にDirectXなどでのプログラミングにおいて、動作がおかしいなどの原因不明のエラーが起きた時は、真っ先に出力ウィンドウを調べましょう。</br>
DirectXからエラーメッセージが出力されている場合があります。</br>
君たちのプログラムで出力ウィンドウに値を出力することもできます。</br>
出力ウィンドウへの出力はOutputDebugStringA()を利用します。</br>

```cpp
OutputDebugStringA("Hello world\n");
```
このような機能は、ゲーム実行中にプレイヤーの体力などを確認したいときに利用します。

### 1.2.3 【ハンズオン】出力ウィンドウを使ってみる。
Sample＿01を利用して、出力ウィンドウに値を出力するコードを追加しましょう。</br>
main.cppの87行目にリスト1.1のプログラムを入力してください。</br>
```cpp
//【ハンズオン】出力ウィンドウを使ってみる。
char text[256];
sprintf(text, "player = %d, com = %d\n", player, com);
OutputDebugStringA(text);
```

入力出来たら実行してください。</br>
出力ウィンドウに変数playerとcomの数値が出力されるようになります。

---
### 1.2.3 データブレイクポイント
最後に超強力なデバッガの機能、「データブレイクポイント」を紹介します。</br>
この機能を使うと、変数の値が変更されたときにプログラムを停止させることができます。</br>
変数の値が不正な値に書き換えらえて意図しない不具合が起きることがあります。</br>
このような不具合の原因を調べることは、大規模なプロジェクトになってくると、非常に難しいこととなってきます。</br>
データブレイクポイントは、このような不正な値の書き換えのデバッグ作業を強力にサポートしてくれます。</br>
データブレイクポイントを設置するためには、監視したいデータのアドレスが必要になってきます。</br>
そのため、ウォッチ機能を使って、対象の変数のアドレスを調べる必要があります。</br>
この設置の仕方を文章で伝えるのは、少々手間ですので、下記の動画を参照してみてください。</br>

[データブレイクポイントの使い方](https://www.youtube.com/watch?v=VBFXB39r-pU)

---
### 1.2.3 【ハンズオン】データブレイクポイントを使ってみる。

#### step-1 main.cppの58行目にブレイクポイントを設置。

#### step-2 デバッガありで実行して、プログラムを58行目で止める。

#### step-3 変数playerのアドレスをコピーする
ウォッチウィンドウに「&player」と入力して、アドレスをコピーしてください(図1.18)。</br></br>

**図1.18**</br>
<img src="fig/1.18.png"></img></br>

#### step-4 データブレイクポイントを設置する。
メニューの「デバッグ/ブレイクポイントの作成/データブレイクポイント」を選択して、データブレイクポイントの作成画面を開く。</br>
開けたら、図1.19のように変数playerのアドレスをコピーして、データブレイクポイントを作成する。</br></br>

#### step-5 プログラムを再開する。
プログラムを再開して、変数playerの値が変わったタイミングでプログラムが停止することを確認してください。</br>

### 1.2.4 評価テスト-2

次の評価テストを行いなさい。</br>
[評価テストへジャンプ](https://docs.google.com/forms/d/e/1FAIpQLScY7MEYxBRd3KWzv0fLrFiL_myaulE-EVPfCDoR2YNqQYVzUQ/viewform?usp=sf_link)
</br>

